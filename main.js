(()=>{"use strict";var e,t,n="https://mesto.nomoreparties.co/v1/wff-cohort-1/",o="55f00a7c-9528-4892-9d7b-63d1b17cdab8",r="users/me",c="cards",i="cards/likes/";function u(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function a(n,o,r,c,i,u){var a=o.cloneNode(!0),l=a.querySelector(".card__image"),s=a.querySelector(".card__title"),d=a.querySelector(".card__delete-button"),p=a.querySelector(".card__like-button"),f=a.querySelector(".card__like-label"),_=n._id;return l.src=n.link,l.alt=n.name,s.textContent=n.name,f.textContent=n.likes.length,p.addEventListener("click",(function(){r(p,f,_)})),l.addEventListener("click",c),n.owner._id!==u&&d.remove(),d.addEventListener("click",(function(){e=_,t=d,i()})),a}function l(e,t,r){var c;e.classList.contains("card__like-button_is-active")?(c=r,fetch(n+i+c,{method:"DELETE",headers:{authorization:o,"Content-Type":"application/json"}}).then((function(e){return u(e)}))).then((function(n){console.log("Лайк с карточки убран:",n),e.classList.remove("card__like-button_is-active"),t.textContent=n.likes.length})).catch((function(e){console.log("Ошибка при удалении лайка",e)})):function(e){return fetch(n+i+e,{method:"PUT",headers:{authorization:o,"Content-Type":"application/json"}}).then((function(e){return u(e)}))}(r).then((function(n){console.log("Лайк на карточку поставлен:",n),e.classList.add("card__like-button_is-active"),t.textContent=n.likes.length})).catch((function(e){console.log("Ошибка при постановке лайка",e)}))}function s(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",p),e.addEventListener("click",f)}function d(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p),e.removeEventListener("click",f)}function p(e){"Escape"===e.key&&d(document.querySelector(".popup_is-opened"))}function f(e){e.target===e.currentTarget&&d(e.currentTarget)}function _(e,t,n){var o=n.inputErrorClass,r=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),c.classList.remove(r),c.textContent=""}function m(e,t,n){var o=n.inactiveButtonClass;!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o)):(t.disabled=!0,t.classList.add(o))}function y(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(n){_(e,n,t),n.setCustomValidity("")})),m(n,o,t)}var v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},h=document.querySelector("#card-template").content,S=document.querySelector(".places__list"),b=document.querySelector(".popup_type_edit"),q=document.querySelector(".profile__edit-button"),g=b.querySelector(".popup__close"),C=document.querySelector('form[name="edit-profile"'),E=C.querySelector(".popup__input_type_name"),L=C.querySelector(".popup__input_type_description"),k=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),T=b.querySelector(".popup__button");q.addEventListener("click",(function(){s(b),E.value=k.textContent,L.value=x.textContent,y(C,v)})),g.addEventListener("click",(function(){d(b)})),C.addEventListener("submit",(function(e){e.preventDefault();var t,c,i=E.value,a=L.value;T.textContent="Сохранение...",T.disabled=!0,(t=i,c=a,fetch(n+r,{method:"PATCH",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:c})}).then((function(e){return u(e)}))).then((function(e){console.log("Редактирование данных профиля прошло успешно =>","\n","Имя:",e.name,"\n","Занятие:",e.about),k.textContent=e.name,x.textContent=e.about,d(b)})).catch((function(e){console.log("Ошибка при редактировании данных профиля:",e)})).finally((function(){T.textContent="Сохранить",T.disabled=!1}))}));var A=document.querySelector(".popup_type_new-card"),j=document.querySelector(".profile__add-button"),z=A.querySelector(".popup__close"),w=document.querySelector('form[name="new-place"'),B=w.querySelector(".popup__input_type_card-name"),D=w.querySelector(".popup__input_type_url"),P=A.querySelector(".popup__button");j.addEventListener("click",(function(){s(A)})),z.addEventListener("click",(function(){d(A)})),w.addEventListener("submit",(function(e){e.preventDefault();var t,r,i=B.value,s=D.value;P.textContent="Сохранение...",P.disabled=!0,(t=i,r=s,fetch(n+c,{method:"POST",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:r})}).then((function(e){return u(e)}))).then((function(e){console.log("Добавление карточки прошло успешно:",e.link);var t=a(e,h,l,M,Y,Q);S.prepend(t),d(A)})).catch((function(e){console.log("Ошибка при добавлении карточки на страницу:",e)})).finally((function(){w.reset(),y(w,v),P.textContent="Сохранить",P.disabled=!1}))}));var I=document.querySelector(".popup_type_image"),N=I.querySelector(".popup__close"),O=I.querySelector(".popup__image"),J=I.querySelector(".popup__caption");function M(e){s(I),O.setAttribute("src",e.target.src),O.setAttribute("alt",e.target.alt),J.textContent=e.target.alt}N.addEventListener("click",(function(){d(I)}));var V=document.querySelector(".profile__image"),H=document.querySelector(".popup_type_change-avatar"),U=H.querySelector(".popup__close"),F=document.querySelector('form[name="new-avatar"'),G=F.querySelector(".popup__input_type_url"),K=H.querySelector(".popup__button");V.addEventListener("click",(function(){s(H)})),U.addEventListener("click",(function(){d(H)})),F.addEventListener("submit",(function(e){e.preventDefault();var t,r=G.value;V.style.backgroundImage=r,K.textContent="Сохранение...",K.disabled=!0,(t=r,fetch(n+"users/me/avatar",{method:"PATCH",headers:{authorization:o,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return u(e)}))).then((function(e){console.log("Обновление аватара произошло успешно:","url('".concat(e.avatar,"')")),V.style.backgroundImage="url('".concat(e.avatar,"')"),d(H)})).catch((function(e){console.log("Ошибка при обновлении аватара:",e)})).finally((function(){F.reset(),y(F,v),K.textContent="Сохранить",K.disabled=!1}))}));var Q,R=document.querySelector(".popup_type_delete"),W=R.querySelector(".popup__close"),X=document.querySelector('form[name="delete-card"'),Y=function(){s(R)},Z=function(){d(R)};W.addEventListener("click",Z),X.addEventListener("submit",(function(r){var i,a,l,s;r.preventDefault(),l=(i={cardId:e,deleteButton:t}).cardId,s=i.deleteButton,(a=l,fetch(n+c+"/"+a,{method:"DELETE",headers:{authorization:o,"Content-Type":"application/json"}}).then((function(e){return u(e)}))).then((function(e){console.log("Удаление карточки произошло успешно:",e),s.closest(".places__item").remove(),Z()})).catch((function(e){console.log("Ошибка при удалении карточки:",e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?_(e,t,n):function(e,t,n,o){var r=o.inputErrorClass,c=o.errorClass,i=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),i.textContent=n,i.classList.add(c)}(e,t,t.validationMessage,n)}(e,r,t),m(n,o,t)}))}))}(t,e)}))}(v),Promise.all([fetch(n+r,{headers:{authorization:o}}).then((function(e){return u(e)})),fetch(n+c,{headers:{authorization:o}}).then((function(e){return u(e)}))]).then((function(e){var t=e[0],n=e[1];console.log("Оба запроса на сервер выполнены успешно =>","\n","Данные профиля:",t,"\n","Массив с карточками:",n),k.textContent=t.name,x.textContent=t.about,Q=t._id,V.style.backgroundImage="url(".concat(t.avatar,")"),function(e,t){e.forEach((function(e){!function(e,t,n,o,r,c,i,u){var a=o(e,n,r,c,i,u);t.append(a)}(e,S,h,a,l,M,Y,t)}))}(n,Q)})).catch((function(e){console.log("Ошибка при выполнении запросов на сервер:",e)}))})();